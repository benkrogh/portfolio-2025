---
import Layout from "./Layout.astro";
import CustomCursor from "@/components/CustomCursor";
import Footer from "@/components/Footer.astro";
import { TEXT_COLOR } from "@/utils/colorUtils";
import type { CollectionEntry } from 'astro:content';

// Import fonts directly in this component
import '../styles/fonts.css';

interface Props {
  post: CollectionEntry<'blog'>;
  Content: any;
}

const { post, Content } = Astro.props;

// No redirect logic here - layouts can't modify responses
---

<Layout title={post?.data?.title || 'Blog Post'}>
  <!-- Preload the font for better performance -->
  <link 
    rel="preload" 
    href="/fonts/GeistMono-Regular.woff2" 
    as="font" 
    type="font/woff2" 
    crossorigin 
    slot="head"
  />
  
  <!-- Consolidated font styles -->
  <style slot="head">
    /* Define font faces once with proper paths and display strategy */
    @font-face {
      font-family: 'Geist Mono';
      src: url('/fonts/GeistMono-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    
    /* Apply the font to all blog content with high specificity */
    .blog-content,
    .blog-content * {
      font-family: 'Geist Mono', monospace !important;
    }
  </style>
  
  <div class="custom-cursor-area">
    <CustomCursor client:only="react" />
    <main class="w-full max-w-[1500px] mx-auto px-4 blog-main font-geist-mono">
      {post?.data && (
        <div
          class="rounded-[32px] h-72 p-8 sm:p-12 pb-12 w-full flex flex-col justify-end"
          style={{
            backgroundColor: post.data.color,
            color: TEXT_COLOR
          }}
        >
          <h1 class="font-geist-mono font-light text-[2.5rem] mb-2">
            {post.data.title}
          </h1>
          <div class="font-geist-mono font-light text-2xl opacity-50">
            <span>{post.data.date}</span>
          </div>
        </div>
      )}
      <div class="prose space-y-2 mx-auto max-w-[660px] mb-4 mt-8 blog-content">
        <article>
          {Content && <Content />}
        </article>
      </div>
    </main>
    <Footer />
  </div>
</Layout>

<style is:global>
  /* Simplified global styles with higher specificity selectors */
  .blog-content,
  .blog-content * {
    font-family: 'Geist Mono', monospace !important;
  }
  
  /* Direct styling for intro paragraphs */
  .blog-content .intro-paragraph {
    font-size: 1.5rem !important;
    line-height: 1.5 !important;
    color: #333 !important;
    font-weight: 400 !important;
    letter-spacing: -0.01em !important;
    margin-bottom: 1.5rem !important;
  }
  
  /* Styling for blockquotes */
  .blog-content blockquote {
    font-size: 1.5rem !important;
    line-height: 1.5 !important;
    color: #333 !important;
    font-weight: 400 !important;
    letter-spacing: -0.01em !important;
    border-left: none !important;
    padding-left: 0 !important;
    margin-left: 0 !important;
    font-style: normal !important;
    margin-bottom: 1.5rem !important;
    quotes: none !important;
  }
  
  /* Additional overrides to prevent quotes */
  .blog-content blockquote::before,
  .blog-content blockquote::after,
  .blog-content blockquote p::before,
  .blog-content blockquote p::after {
    content: '' !important;
    display: none !important;
  }
  
  /* Make H3 headings bolder */
  .blog-content h3 {
    font-size: 1.375rem !important;
    line-height: 1.4 !important;
    font-weight: 500 !important;
    color: #17120A !important;
    letter-spacing: -0.02em !important;
  }
</style>

<script>
  // Simplified script that focuses on guaranteeing font loading
  document.addEventListener('DOMContentLoaded', () => {
    // Check if the font is already loaded
    document.fonts.ready.then(() => {
      // Force reload the font if it's not available
      if (!document.fonts.check("1em 'Geist Mono'")) {
        const fontLoader = new FontFace(
          'Geist Mono', 
          "url('/fonts/GeistMono-Regular.woff2') format('woff2')",
          { display: 'swap' }
        );
        
        fontLoader.load().then(font => {
          document.fonts.add(font);
          
          // Mark elements to force repaint with the loaded font
          document.querySelectorAll('.blog-content *').forEach(el => {
            if (el instanceof HTMLElement) {
              el.style.fontFamily = "'Geist Mono', monospace";
            }
          });
        }).catch(err => {
          console.error('Font loading failed:', err);
        });
      }
    });
  });
</script>
